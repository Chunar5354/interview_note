## 用户空间与内核空间

[参考](https://mp.weixin.qq.com/s/xej6klx2q0G1fp82_vKCOg)

虚拟内存划分为两部分：内核空间与用户空间（`1:3`）

内核空间在`高位`，用户空间在低位

运行在内核空间的进程处于内核态，运行在用户空间的进程处于用户态

用户态的进程不能够直接访问内核空间的数据，也不能直接调用内核函数，需要通过`系统调用`

Linux系统内部可以划分为三级：硬件、内核空间和用户空间

## I/O读写

Linux I/O读写有三种方式：轮询，中断和DMA（Direct Memory Access，直接内存存取）

轮询方式最消耗CPU

中断方式中，每次I/O中断，CPU都要切换一次上下文（用户态与内核态之间，因为用户态`不能直接访问I/O`）

基于DMA方式，数据传输可以绕开CPU的全程调度，CPU只需要调度`DMA控制器`

## 零拷贝

三种方式实现：

- 1.用户态直接I/O，即不经过内核拷贝，硬件上的数据`直接拷贝到用户空间`，但仍需要上下文切换

- 2.减少数据拷贝次数，在内核空间中，直接将读方的数据拷贝到写方，但是这样用户的应用程序`不能对数据进行修改`

- 3.写时复制，当多个进程共享一块数据时，其中一个进程需要修改数据时，就将数据拷贝一份到自己的私有地址空间中，这样对于只读的进程来说这份共享的数据`永远不需要拷贝`