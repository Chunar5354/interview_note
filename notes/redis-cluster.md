redis有三种集群模式：主从复制模式、哨兵模式和cluster模式

## 主从复制模式

主从模式主要目的是为了分担master的读写压力，以及便于容灾恢复

有两种角色：主节点和从节点，从节点一般是`只读`的，相当于主节点的副本

主从复制的过程：

- 1.创建主节点

- 2.创建从节点，从节点向主节点发送SYNC命令

- 3.主节点接收到SYNC后，执行BGSAVE生成`RDB`文件并使用`缓冲区`记录之后的所有`写命令`

- 4.主节点BGSAVE完成后，向所有从节点发送`数据快照`

- 5.从节点接受到快照后`丢弃旧数据`，写入新数据（`全量`同步）

- 6.从节点完成快照的写入后，开始`接收`来自主节点的写命令

- 7.主节点每执行一个写命令就向从节点发送相同的写命令

- 8.从节点断开重连后，由主节点把断开期间的数据发给从节点，进行`增量`同步

缺点：

- 1.宕机后需要人工恢复

- 2.主节点宕机会导致数据不一致

- 3.多个从节点同时断线恢复时会向主机请求全量恢复，导致主节点IO增加

- 4.难以在线扩容

## 哨兵模式

哨兵是一个独立的`进程`，负责监视主从节点的状态

哨兵解决了手动恢复的问题，但仍然难以在线扩容

## cluster模式

在主从模式和哨兵模式中，主从节点存储的是相同的数据

而在cluster模式中，不同的redis节点存储的是`不同的数据`

在cluster模式中，集群内的任意两个节点都是相通的，互相可以访问

redis使用`哈希槽`的方式来分布节点，共有`16384`（2^14）个槽，每个节点平均分配一部分槽，当一个key到达时，根据CRC16算法得到一个值，对16384取余，就得到了对应的节点

当有新节点加入时，会得到现有节点的一部分槽，当有节点退出时，它的槽会分配给其它的节点

为了保证高可用，cluster也采用了主从复制模式，可以有`多个主节点`，每个主节点有多个从节点（`副本`）
