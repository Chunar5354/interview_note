## TCP拥塞控制

TCP通过重传机制来保障可靠传输，担当网络线路出现拥堵时，继续重传会加重拥堵情况

所以要进行拥塞控制来限制发送方的`速率`

通过拥塞窗口`cwnd`大小来控制，速率为`cwnd/RTT`

### 拥塞控制算法

TCP主要有3个拥塞控制算法：慢启动，拥塞避免，快速恢复，分别对应三个状态

#### 慢启动

一开始将cwnd设为MSS（最大报文段长度），每收到一次正确的`确认`，就将cwmd`乘2`

离开慢启动状态的情况：

- 1.当cwnd达到一个设定的阈值`ssthresh`时，进入`拥塞避免`

- 2.当出现`超时`，将cwnd设为1，ssthresh设为`当前cwnd/2`，重新开始新一轮`慢启动`

- 3.出现3个冗余ACK，执行快速重传，并进入`快速恢复`状态

- 为什么会有冗余ACK：TCP连接中，接收方每收到报文段都要对最后一个收到的`有序报文段`发送响应，因此若发送了报文段1,2,4，而3号丢失，当接收方连续三次接收到对报文段2的ACK后，就知道3丢失了，就`快速重传`3号

#### 拥塞避免

当`cwnd达到ssthresh`时进入拥塞避免状态

拥塞避免状态中每次将cwnd的值增加`1个MSS`

离开拥塞控制状态的情况：

- 1.出现超时，cwnd设1，ssthresh设为`当前cwnd/2`，进入`慢启动`

- 2.3个冗余ACK，`快速恢复`

#### 快速恢复

将ssthresh设为`cwnd/2`，然后令`cwnd=ssthresh+3`（3个冗余ACK占用）

然后每当再收到冗余ACK，cwnd加1，直到收到`新的ACK`，令`cwnd=ssthresh`，进入`拥塞避免`

若在中途出现超时，则同上面一样进入慢启动