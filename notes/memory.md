## 物理内存与虚拟内存

[参考1](https://mp.weixin.qq.com/s/xej6klx2q0G1fp82_vKCOg)

[参考2](https://sylvanassun.github.io/2017/10/29/2017-10-29-virtual_memory/)

虚拟内存是围绕进程产生的

虚拟内存为进程提供了一致的、私有的地址空间，每个进程都认为自己在`独享主存`

虚拟内存将主存看成磁盘的高速缓存，将不连续的物理地址映射到了`连续的虚拟地址`上，为程序编写带来了便利

虚拟内存的大小为`2^计算机位数`，但64位机器只用到了`2^48`

## 页表

每个进程都有`独立的`虚拟地址空间，保存在独立的页表中，页表保存在`高速缓存或主存中`

页表是页表条目(Page Table Entry PTE)的集合，每次CPU进行虚拟寻址时，都需要通过内存管理单元(Memory Management Unit MMU)结合页表来将虚拟地址`翻译`成物理地址

使用页表时，用虚拟地址的`高位`查找地址在哪一页，`低12位`查找某一条目在这一页的偏移量，所以每一页`4KB`，每一条PTE`4字节`

页命中和缺页（页不命中，在主存中选择牺牲页）

- 二级页表优点：分级之后，如果一级页表的条目为空，二级页表就`不必存在`，且二级页表不必存在主存中，可以在`需要时被创建`

### 页表缓存TLB

多级页表的查询效率较低，所以在内存管理单元中设计了一个关于PTE的缓存，称为`翻译后备缓冲器`(Translation Lookaside Buffer, TLB)

在进程切换时，原来TLB缓存将不可用，所以切换之后地址翻译要变慢
